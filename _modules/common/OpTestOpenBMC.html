
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>common.OpTestOpenBMC &#8212; op-test-framework pre-v1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for common.OpTestOpenBMC</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># OpenPOWER Automated Test Project</span>
<span class="c1">#</span>
<span class="c1"># Contributors Listed Below - COPYRIGHT 2017</span>
<span class="c1"># [+] International Business Machines Corp.</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span>
<span class="c1"># implied. See the License for the specific language governing</span>
<span class="c1"># permissions and limitations under the License.</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">OpTestSSH</span> <span class="k">import</span> <span class="n">OpTestSSH</span>
<span class="kn">from</span> <span class="nn">OpTestIPMI</span> <span class="k">import</span> <span class="n">OpTestIPMI</span>
<span class="kn">from</span> <span class="nn">OpTestUtil</span> <span class="k">import</span> <span class="n">OpTestUtil</span>
<span class="kn">from</span> <span class="nn">OpTestBMC</span> <span class="k">import</span> <span class="n">OpTestBMC</span>
<span class="kn">from</span> <span class="nn">Exceptions</span> <span class="k">import</span> <span class="n">CommandFailed</span><span class="p">,</span> <span class="n">LoginFailure</span>
<span class="kn">from</span> <span class="nn">common.OpTestError</span> <span class="k">import</span> <span class="n">OpTestError</span>
<span class="kn">from</span> <span class="nn">OpTestConstants</span> <span class="k">import</span> <span class="n">OpTestConstants</span> <span class="k">as</span> <span class="n">BMC_CONST</span>
<span class="kn">from</span> <span class="nn">common</span> <span class="k">import</span> <span class="n">OPexpect</span>
<span class="kn">import</span> <span class="nn">OpTestSystem</span>

<div class="viewcode-block" id="FailedCurlInvocation"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.FailedCurlInvocation">[docs]</a><span class="k">class</span> <span class="nc">FailedCurlInvocation</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;CURL invocation &#39;</span><span class="si">%s</span><span class="s2">&#39; failed</span><span class="se">\n</span><span class="s2">Output:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>


<div class="viewcode-block" id="CurlTool"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool">[docs]</a><span class="k">class</span> <span class="nc">CurlTool</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="s2">&quot;curl&quot;</span><span class="p">,</span>
                 <span class="n">ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logresult</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_bkup</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login_retry</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="CurlTool.feed_data"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.feed_data">[docs]</a>    <span class="k">def</span> <span class="nf">feed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbus_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">operation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upload_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remote_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">dbus_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">operation</span> <span class="c1"># &#39;r-read, w-write, rw-read/write&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span> <span class="o">=</span> <span class="n">upload_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_file</span> <span class="o">=</span> <span class="n">remote_name</span></div>

<div class="viewcode-block" id="CurlTool.binary_name"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.binary_name">[docs]</a>    <span class="k">def</span> <span class="nf">binary_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span></div>

    <span class="c1"># -H, --header LINE   Pass custom header LINE to server (H)&#39;</span>
<div class="viewcode-block" id="CurlTool.custom_header"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.custom_header">[docs]</a>    <span class="k">def</span> <span class="nf">custom_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\&#39;</span><span class="s2">Content-Type: application/json</span><span class="se">\&#39;</span><span class="s2"> &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span></div>

<div class="viewcode-block" id="CurlTool.http_post_data"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.http_post_data">[docs]</a>    <span class="k">def</span> <span class="nf">http_post_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Example data formats</span>
<span class="sd">        data = &#39;\&#39;{&quot;data&quot;: [ &quot;root&quot;, &quot;0penBmc&quot; ] }\&#39;&#39;</span>
<span class="sd">        data = &#39;\&#39;{&quot;data&quot; : []}\&#39;&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

    <span class="c1"># -b, --cookie STRING/FILE  Read cookies from STRING/FILE (H)</span>
<div class="viewcode-block" id="CurlTool.read_cookie"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.read_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">read_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="s1">&#39; -b cjar &#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span></div>

    <span class="c1"># -c, --cookie-jar FILE  Write cookies to FILE after operation (H)</span>
<div class="viewcode-block" id="CurlTool.write_cookie"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.write_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">write_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="s1">&#39; -c cjar &#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span></div>

<div class="viewcode-block" id="CurlTool.get_cookies"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.get_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">get_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cookie</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_cookie</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;rw&#39;</span><span class="p">:</span>
            <span class="n">cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cookie</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_cookie</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">cookies</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid operation&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CurlTool.request_command"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.request_command">[docs]</a>    <span class="k">def</span> <span class="nf">request_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
            <span class="c1"># default is GET command</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span></div>

<div class="viewcode-block" id="CurlTool.dbus_interface"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.dbus_interface">[docs]</a>    <span class="k">def</span> <span class="nf">dbus_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;https://</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="CurlTool.arguments"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot; -s&quot;</span>
        <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -k &quot;</span>
        <span class="c1"># -J, --remote-header-name  Use the header-provided filename (H)</span>
        <span class="c1">#  -O, --remote-name   Write output to a file named as the remote file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_file</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -O -J &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -H </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -d </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_post_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -T </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="s2">&quot; -X </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_command</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbus_interface</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="CurlTool.bkup_cmd"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.bkup_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">bkup_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_bkup</span> <span class="o">=</span> <span class="n">cmd</span></div>

<div class="viewcode-block" id="CurlTool.run"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmdprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_bkup</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_bkup</span>
        <span class="k">elif</span> <span class="n">cmdprefix</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmdprefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">()</span> <span class="o">+</span> <span class="n">cmd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">()</span>
        <span class="nb">print</span> <span class="n">cmd</span>
        <span class="k">if</span> <span class="n">background</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">l_msg</span> <span class="o">=</span> <span class="s2">&quot;Curl Command Failed&quot;</span>
                <span class="nb">print</span> <span class="n">l_msg</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="n">l_msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">child</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO - need python 2.7</span>
            <span class="c1"># output = check_output(cmd, stderr=subprocess.STDOUT, shell=True)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                                       <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">l_msg</span> <span class="o">=</span> <span class="s2">&quot;Curl Command Failed&quot;</span>
                <span class="nb">print</span> <span class="n">l_msg</span>
                <span class="nb">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="n">l_msg</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logresult</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">output</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;description&quot;: &quot;Login required&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">login_retry</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">LoginFailure</span><span class="p">(</span><span class="s2">&quot;Rest Login retry exceeded&quot;</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">cmd_bkup</span> <span class="o">=</span>  <span class="n">cmd</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login_retry</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bkup_cmd</span><span class="p">(</span><span class="n">cmd_bkup</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_bkup</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;status&quot;: &quot;error&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">output</span>
                <span class="k">raise</span> <span class="n">FailedCurlInvocation</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="CurlTool.log_result"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.log_result">[docs]</a>    <span class="k">def</span> <span class="nf">log_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logresult</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CurlTool.login"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.CurlTool.login">[docs]</a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot;: [ &quot;</span><span class="si">%s</span><span class="s1">&quot;, &quot;</span><span class="si">%s</span><span class="s1">&quot; ] }</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">fci</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">output</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;description&quot;: &quot;Invalid username or password&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LoginFailure</span><span class="p">(</span><span class="s2">&quot;Rest login invalid username or password&quot;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="HostManagement"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement">[docs]</a><span class="k">class</span> <span class="nc">HostManagement</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span> <span class="o">=</span> <span class="n">CurlTool</span><span class="p">(</span><span class="n">ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                             <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                             <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span> <span class="o">=</span> <span class="n">OpTestUtil</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">PingFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">BMC_CONST</span><span class="o">.</span><span class="n">PING_RETRY_FOR_STABILITY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    curl -c cjar -k -X POST -H &quot;Content-Type: application/json&quot; \</span>
<span class="sd">    -d &#39;{&quot;data&quot;: [ &quot;root&quot;, &quot;0penBmc&quot; ] }&#39; https://bmc/login</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.login"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.login">[docs]</a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot;: [ &quot;</span><span class="si">%s</span><span class="s1">&quot;, &quot;</span><span class="si">%s</span><span class="s1">&quot; ] }</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">fci</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">output</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;description&quot;: &quot;Invalid username or password&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LoginFailure</span><span class="p">(</span><span class="s2">&quot;Rest login invalid username or password&quot;</span><span class="p">)</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Logout:</span>
<span class="sd">    curl -c cjar -b cjar -k -X POST -H &quot;Content-Type: application/json&quot; \</span>
<span class="sd">    -d &#39;{&quot;data&quot;: [ ] }&#39; \</span>
<span class="sd">    https://bmc/logout</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.logout"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.logout">[docs]</a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="s2">&quot;/logout&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inventory enumerate:</span>
<span class="sd">    /xyz/openbmc_project/inventory</span>
<span class="sd">    curl -b cjar -k https://bmc/xyz/openbmc_project/inventory/enumerate</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.get_inventory"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">get_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="s2">&quot;/xyz/openbmc_project/inventory/enumerate&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.sensors"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.sensors">[docs]</a>    <span class="k">def</span> <span class="nf">sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="s2">&quot;/xyz/openbmc_project/sensors/enumerate&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get Current Host Power State:</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{&quot;data&quot;:</span>
<span class="sd">    []}&#39; https://bmc/xyz/openbmc_project/state/host0/attr/CurrentHost</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.get_power_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_power_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_power_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s1">&#39;/xyz/openbmc_project/state/host0/attr/CurrentHostState&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get Host State:</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{&quot;data&quot;:</span>
<span class="sd">    []}&#39; https://bmc/xyz/openbmc_project/state/host0/attr/CurrentHostState</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.get_host_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_host_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s1">&#39;/xyz/openbmc_project/state/host0/attr/CurrentHostState&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reboot server gracefully:</span>
<span class="sd">    curl -c cjar b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    -d &#39;{&quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;}&#39;</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.soft_reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.soft_reboot">[docs]</a>    <span class="k">def</span> <span class="nf">soft_reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Host.Transition.Reboot</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reboot server Immediately:</span>
<span class="sd">    curl -c cjar b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    -d &#39;{&quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.Reboot&quot;}&#39;</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.hard_reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.hard_reboot">[docs]</a>    <span class="k">def</span> <span class="nf">hard_reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Host.Transition.Reboot</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    power soft server:</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    -d &#39;{&quot;data&quot;: &quot;xyz.openbmc_project.State.Chassis.Transition.Off&quot;}&#39;</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.power_soft"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_soft">[docs]</a>    <span class="k">def</span> <span class="nf">power_soft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Chassis.Transition.Off</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    power off server:</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/chassis0/attr/RequestedHostTransition</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.power_off"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_off">[docs]</a>    <span class="k">def</span> <span class="nf">power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Chassis.Transition.Off</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/chassis0/attr/RequestedPowerTransition&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;# Ignoring failure powering off chassis, trying powering off host&quot;</span>
            <span class="k">pass</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Host.Transition.Off</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    power on server:</span>
<span class="sd">    curl -c cjar b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    -d &#39;{&quot;data&quot;: &quot;xyz.openbmc_project.State.Host.Transition.On&quot;}&#39;</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/host0/attr/RequestedHostTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.power_on"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_on">[docs]</a>    <span class="k">def</span> <span class="nf">power_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.Host.Transition.On</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/RequestedHostTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List SEL</span>
<span class="sd">    curl -b cjar -k -H &quot;Content-Type: application/json&quot; -X GET \</span>
<span class="sd">    -d &#39;{&quot;data&quot; : []}&#39; \</span>
<span class="sd">    https://bmc/xyz/openbmc_project/logging/enumerate</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.list_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.list_sel">[docs]</a>    <span class="k">def</span> <span class="nf">list_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;List of SEL entries&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/enumerate&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.get_sel_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_sel_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_sel_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_sel</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/xyz/openbmc_project/logging/entry/(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">sels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">sels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sels</span></div>

<div class="viewcode-block" id="HostManagement.clear_sel_by_id"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_sel_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">clear_sel_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;Clearing SEL entries by id&quot;</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sel_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/entry/</span><span class="si">%s</span><span class="s2">/action/Delete&quot;</span> <span class="o">%</span> <span class="nb">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.verify_clear_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.verify_clear_sel">[docs]</a>    <span class="k">def</span> <span class="nf">verify_clear_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;Check if SEL has really zero entries or not&quot;</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sel_ids</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    clear SEL : Clearing complete SEL</span>
<span class="sd">    curl -b cjar -k -H &quot;Content-Type: application/json&quot; -X POST \</span>
<span class="sd">    -d &#39;{&quot;data&quot; : []}&#39; \</span>
<span class="sd">    https://bmc/xyz/openbmc_project/logging/action/DeleteAll</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.clear_sel"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_sel">[docs]</a>    <span class="k">def</span> <span class="nf">clear_sel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/logging/action/DeleteAll&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;# Ignoring failure clearing SELs, not all OpenBMC builds support this yet&quot;</span>
            <span class="k">pass</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get current boot device info</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;data&quot; : []}&#39; -X GET</span>
<span class="sd">    https://bmc/xyz/openbmc_project/control/host0/boot/attr/bootmode</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.get_current_bootdev"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_current_bootdev">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_bootdev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/bootmode&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Setup&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;Setup&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Regular&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">bootmode</span> <span class="o">=</span> <span class="s2">&quot;Regular&quot;</span>
        <span class="k">return</span> <span class="n">bootmode</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    set boot device to setup</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot;</span>
<span class="sd">    -d &quot;{&quot;data&quot;: \&quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Setup\&quot;}&quot; -X PUT</span>
<span class="sd">    https://bmc/xyz/openbmc_project/control/host0/boot/attr/bootmode</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.set_bootdev_to_setup"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_bootdev_to_setup">[docs]</a>    <span class="k">def</span> <span class="nf">set_bootdev_to_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot;: </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.Control.Boot.Mode.Modes.Setup</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/bootmode&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    set boot device to regular/default</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot;</span>
<span class="sd">    -d &quot;{&quot;data&quot;: \&quot;xyz.openbmc_project.Control.Boot.Mode.Modes.Regular\&quot;}&quot; -X PUT</span>
<span class="sd">    https://bmc/xyz/openbmc_project/control/host0/boot/attr/bootmode</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.set_bootdev_to_none"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_bootdev_to_none">[docs]</a>    <span class="k">def</span> <span class="nf">set_bootdev_to_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot;: </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.Control.Boot.Mode.Modes.Regular</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/boot/attr/bootmode&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get boot progress info</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -d</span>
<span class="sd">    &#39;{&quot;data&quot;: [ ] }&#39; -X GET</span>
<span class="sd">    https://bmc//xyz/openbmc_project/state/host0/attr/BootProgress</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.get_boot_progress"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_boot_progress">[docs]</a>    <span class="k">def</span> <span class="nf">get_boot_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host0/attr/BootProgress&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Wait for OpenBMC Host state</span>
<span class="sd">    This is only on more modern OpenBMC builds.</span>
<span class="sd">    If unsupported, return None and fall back to old method.</span>
<span class="sd">    We can&#39;t just continue to use the old method until it disappears as</span>
<span class="sd">    it is actively broken (always returns Off).</span>
<span class="sd">    NOTE: The whole BMC:CHassis:Host mapping is completely undocumented and</span>
<span class="sd">    undiscoverable. At some point, this may change from 0,0,0 and one of each and</span>
<span class="sd">    everything is going to be a steaming pile of fail.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.wait_for_host_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_host_state">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_host_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_state</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/host</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="n">target_state</span> <span class="o">=</span> <span class="s2">&quot;xyz.openbmc_project.State.Host.HostState.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_state</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CurrentHostState&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;CurrentHostState&#39;</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s2">&quot;System state: </span><span class="si">%s</span><span class="s2"> (target </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">target_state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">target_state</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="s2">&quot;Timeout waiting for host state to become </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_state</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_standby"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_standby">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_standby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_host_state</span><span class="p">(</span><span class="s2">&quot;Off&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Falling back to old BootProgress&quot;</span>
            <span class="k">return</span> <span class="n">old_wait_for_standby</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_runtime"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_host_state</span><span class="p">(</span><span class="s2">&quot;Running&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Falling back to old BootProgress&quot;</span>
            <span class="k">return</span> <span class="n">old_wait_for_standby</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Boot progress</span>
<span class="sd">    curl   -b cjar   -k  -H  &#39;Content-Type: application/json&#39;   -d &#39;{&quot;data&quot;: [ ] }&#39;</span>
<span class="sd">    -X GET https://bmc//xyz/openbmc_project/state/host0/attr/BootProgress</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.old_wait_for_runtime"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.old_wait_for_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">old_wait_for_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/org/openbmc/sensors/host/BootProgress&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s2">&quot;System state: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">state</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;FW Progress, Starting OS&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;System FW booted to runtime: IPL finished&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">l_msg</span> <span class="o">=</span> <span class="s2">&quot;IPL timeout&quot;</span>
                <span class="nb">print</span> <span class="n">l_msg</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="n">l_msg</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.old_wait_for_standby"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.old_wait_for_standby">[docs]</a>    <span class="k">def</span> <span class="nf">old_wait_for_standby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/org/openbmc/sensors/host/BootProgress&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s2">&quot;System state: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">state</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;Off&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;System reached standby state&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">l_msg</span> <span class="o">=</span> <span class="s2">&quot;Standby timeout&quot;</span>
                <span class="nb">print</span> <span class="n">l_msg</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="n">l_msg</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    BMC reset</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot;</span>
<span class="sd">    -d &quot;{\&quot;data\&quot; : \&quot;xyz.openbmc_project.State.BMC.Transition.Reboot\&quot;}&quot; -X PUT</span>
<span class="sd">    https://bmc/xyz/openbmc_project/state/bmc0/attr/RequestedBMCTransition</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostManagement.bmc_reset"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.bmc_reset">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1"> : </span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.State.BMC.Transition.Reboot</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/bmc0/attr/RequestedBMCTransition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="c1"># Wait for BMC to go down.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ping_fail_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
        <span class="c1"># Wait for BMC to ping back.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">PingFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">BMC_CONST</span><span class="o">.</span><span class="n">PING_RETRY_FOR_STABILITY</span><span class="p">)</span>
        <span class="c1"># Wait for BMC ready state.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.get_bmc_state"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_bmc_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_bmc_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/state/bmc0/attr/CurrentBMCState&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_bmc_runtime"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_bmc_runtime">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_bmc_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;description&quot;: &quot;Login required&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bmc_state</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">output</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;data&quot;: &quot;xyz.openbmc_project.State.BMC.BMCState.Ready&quot;&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;BMC is UP &amp; Ready&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">l_msg</span> <span class="o">=</span> <span class="s2">&quot;BMC Ready timeout&quot;</span>
                <span class="nb">print</span> <span class="n">l_msg</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="n">l_msg</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.get_list_of_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_list_of_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_of_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/xyz/openbmc_project/software/(.*)&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1"># According to the OpenBMC docs, Image ID can be</span>
            <span class="c1"># Implementation defined, and thus, the word &#39;active&#39;</span>
            <span class="c1"># would be a valid ID.</span>
            <span class="c1"># Except that it isn&#39;t. The documentation is lies.</span>
            <span class="c1"># It seems that &#39;active&#39; is special.</span>
            <span class="c1"># There is no documentation as to what other</span>
            <span class="c1"># strings are special, or could become special.</span>
            <span class="c1"># So, HACK HACK HACK around it. :(</span>
            <span class="c1"># https://github.com/openbmc/phosphor-dbus-interfaces/tree/55d03ca/xyz/openbmc_project/Software#image-identifier</span>
            <span class="c1"># This is getting insane, it&#39;s not just &#39;active&#39;</span>
            <span class="c1"># It&#39;s &#39;functional&#39; as well. Or some other things.</span>
            <span class="c1"># So, we assume that if we don&#39;t have &#39;Purpose&#39; it&#39;s something special</span>
            <span class="c1"># like the &#39;active&#39; or (new) &#39;functional&#39;.</span>
            <span class="c1"># Adriana has promised me that this is safe into the future.</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="nb">print</span> <span class="s2">&quot;List of images id&#39;s: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ids</span>
        <span class="k">return</span> <span class="n">ids</span></div>

<div class="viewcode-block" id="HostManagement.image_data"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.image_data">[docs]</a>    <span class="k">def</span> <span class="nf">image_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">())</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload a image</span>
<span class="sd">    curl   -b cjar  -c cjar   -k  -H  &#39;Content-Type: application/octet-stream&#39;   -T witherspoon.pnor.squashfs.tar</span>
<span class="sd">    -X POST https://bmc//upload/image</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.upload_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.upload_image">[docs]</a>    <span class="k">def</span> <span class="nf">upload_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\&#39;</span><span class="s2">Content-Type: application/octet-stream</span><span class="se">\&#39;</span><span class="s2"> &quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/upload/image&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">upload_file</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="c1"># priority 0 -primary (Boot side of the image)</span>
<div class="viewcode-block" id="HostManagement.get_image_priority"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_image_priority">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Priority&#39;</span><span class="p">]</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the image priority</span>
<span class="sd">    curl -b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT -d &#39;{&quot;data&quot;:0}&#39;</span>
<span class="sd">    https://$BMC_IP/xyz/openbmc_project/software/061c4bdb/attr/Priority</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.set_image_priority"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_image_priority">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">%s</span><span class="s2">/attr/Priority&quot;</span> <span class="o">%</span> <span class="nb">id</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1">:</span><span class="si">%s</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<div class="viewcode-block" id="HostManagement.image_ready_for_activation"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.image_ready_for_activation">[docs]</a>    <span class="k">def</span> <span class="nf">image_ready_for_activation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Activation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;xyz.openbmc_project.Software.Activation.Activations.Ready&quot;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Image upload is successful &amp; Ready for activation&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="s2">&quot;Image is not ready for activation/Timeout happened&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Activate a image</span>
<span class="sd">    curl -b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    -d &#39;{&quot;data&quot;:&quot;xyz.openbmc_project.Software.Activation.RequestedActivations.Active&quot;}&#39;</span>
<span class="sd">    https://bmc/xyz/openbmc_project/software/&lt;image id&gt;/attr/RequestedActivation</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.activate_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.activate_image">[docs]</a>    <span class="k">def</span> <span class="nf">activate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">%s</span><span class="s2">/attr/RequestedActivation&quot;</span> <span class="o">%</span> <span class="nb">id</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{</span><span class="se">\&quot;</span><span class="s1">data</span><span class="se">\&quot;</span><span class="s1">:</span><span class="se">\&quot;</span><span class="s1">xyz.openbmc_project.Software.Activation.RequestedActivations.Active</span><span class="se">\&quot;</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a image</span>
<span class="sd">    curl -b cjar -k -H &quot;Content-Type: application/json&quot; -X DELETE</span>

<span class="sd">    https://bmc/xyz/openbmc_project/software/&lt;image id&gt;/attr/RequestedActivation</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.delete_image"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_image">[docs]</a>    <span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># First, we try the &quot;new&quot; method, as of at least ibm-v2.0-0-r26.1-0-gfb7714a</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">%s</span><span class="s2">/action/delete&quot;</span> <span class="o">%</span> <span class="nb">id</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Try falling back to the old method (everything prior? who knows)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>



<div class="viewcode-block" id="HostManagement.wait_for_image_active_complete"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_image_active_complete">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_image_active_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">timeout</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Activation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Activation.Activations.Activating&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Image activation is in progress&quot;</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Activation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Activation.Activations.Active&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Image activated successfully, Good to go for power on....&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Activation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Activation.Activations.Failed&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Image activation failed. Good luck.&quot;</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpTestError</span><span class="p">(</span><span class="s2">&quot;Image is failed to activate/Timeout happened&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HostManagement.host_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.host_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">host_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_image_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[:]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="c1"># Here, we assume that if we don&#39;t have &#39;Purpose&#39; it&#39;s something special</span>
            <span class="c1"># like the &#39;active&#39; or (new) &#39;functional&#39;.</span>
            <span class="c1"># Adriana has promised me that this is safe.</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.Host&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;Host Image IDS: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l</span></div>

<div class="viewcode-block" id="HostManagement.bmc_image_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.bmc_image_ids">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_image_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_image_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[:]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="c1"># Here, we assume that if we don&#39;t have &#39;Purpose&#39; it&#39;s something special</span>
            <span class="c1"># like the &#39;active&#39; or (new) &#39;functional&#39;.</span>
            <span class="c1"># Adriana has promised me that this is safe.</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.BMC&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;BMC Image IDS: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Listing available Dumps:</span>
<span class="sd">    $ curl -c cjar -b cjar -k https://$BMC_IP/xyz/openbmc_project/dump/list</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.list_available_dumps"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.list_available_dumps">[docs]</a>    <span class="k">def</span> <span class="nf">list_available_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/list&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<div class="viewcode-block" id="HostManagement.get_dump_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_dump_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_dump_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dump_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_available_dumps</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/xyz/openbmc_project/dump/entry/(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">dump_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">dump_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dump_ids</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Down Load Dump:</span>
<span class="sd">    $ curl -O -J -c cjar -b cjar -k -X GET https://$BMC_IP/download/dump/$ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.download_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.download_dump">[docs]</a>    <span class="k">def</span> <span class="nf">download_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/download/dump/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dump_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">remote_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete dump.</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -d &quot;{\&quot;data\&quot;: []}&quot;</span>
<span class="sd">      -X POST  https://$BMC_IP/xyz/openbmc_project/dump/entry/3/action/Delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.delete_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_dump">[docs]</a>    <span class="k">def</span> <span class="nf">delete_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/entry/</span><span class="si">%s</span><span class="s2">/action/Delete&quot;</span> <span class="o">%</span> <span class="n">dump_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.delete_all_dumps"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.delete_all_dumps">[docs]</a>    <span class="k">def</span> <span class="nf">delete_all_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dump_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_dump</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create new Dump:</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -d &quot;{\&quot;data\&quot;: []}&quot;</span>
<span class="sd">       -X POST  https://$BMC_IP/xyz/openbmc_project/dump/action/CreateDump</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.create_new_dump"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.create_new_dump">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/dump/action/CreateDump&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">dump_capture</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">dump_capture</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">FailedCurlInvocation</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">output</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dump_capture</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;OpenBMC Dump capture was successful&quot;</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;exception&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DBusException(&#39;Dump not captured due to a cap.&#39;,)&quot;</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Dumps are exceeded in the system, trying to delete existing ones&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_all_dumps</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="HostManagement.wait_for_dump_finish"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.wait_for_dump_finish">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_dump_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_id</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dump_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">dump_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Dump </span><span class="si">%s</span><span class="s2"> is ready to download/offload&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">dump_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.software_enumerate"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.software_enumerate">[docs]</a>    <span class="k">def</span> <span class="nf">software_enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">())</span></div>

    <span class="c1"># Returns True  - if field mode enabled.</span>
    <span class="c1">#         False - if it is disabled.</span>
<div class="viewcode-block" id="HostManagement.has_field_mode_set"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.has_field_mode_set">[docs]</a>    <span class="k">def</span> <span class="nf">has_field_mode_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_enumerate</span><span class="p">()</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FieldModeEnabled&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set field mode : 1 - enables it</span>
<span class="sd">    curl -b cjar -k -H &#39;Content-Type: application/json&#39; -X PUT -d &#39;{&quot;data&quot;:0}&#39;</span>
<span class="sd">    https://bmcip/xyz/openbmc_project/software/attr/FieldModeEnabled</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.set_field_mode"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.set_field_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_field_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/attr/FieldModeEnabled&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : </span><span class="si">%s</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">())</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1. functional boot side validation for both BMC and PNOR.</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; https://$BMC_IP/xyz/openbmc_project/software/functional</span>
<span class="sd">    {</span>
<span class="sd">    &quot;data&quot;: {</span>
<span class="sd">        &quot;endpoints&quot;: [</span>
<span class="sd">        &quot;/xyz/openbmc_project/software/061c4bdb&quot;,</span>
<span class="sd">        &quot;/xyz/openbmc_project/software/608e9ebe&quot;</span>
<span class="sd">        ]</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.validate_functional_bootside"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.validate_functional_bootside">[docs]</a>    <span class="k">def</span> <span class="nf">validate_functional_bootside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/functional&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="nb">print</span> <span class="n">output</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.is_image_already_active"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_image_already_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_image_already_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;Activation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Activation.Activations.Active&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HostManagement.get_occ_ids"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_occ_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_occ_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/enumerate&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">occ_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/org/open_power/control/occ(\d{1,})$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">occ_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">occ_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">occ_ids</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get state of OCC&#39;s</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X  GET</span>
<span class="sd">    https://$BMC_IP/org/open_power/control/occ0</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.is_occ_active"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_occ_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_occ_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/occ</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;OccActive&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;# OCC</span><span class="si">%s</span><span class="s2"> is active&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="nb">print</span> <span class="s2">&quot;# OCC</span><span class="si">%s</span><span class="s2"> is not active&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    curl -b cjar -k -H &#39;Content-Type: application/json&#39; -X PUT -d &#39;{&quot;data&quot;:0}&#39;</span>
<span class="sd">    https://$BMC_IP/xyz/openbmc_project/control/host0/power_cap/attr/PowerCapEnable</span>
<span class="sd">    0 - Disable by default, 1 - Enable</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.enable_power_cap"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.enable_power_cap">[docs]</a>    <span class="k">def</span> <span class="nf">enable_power_cap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/power_cap/attr/PowerCapEnable&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : </span><span class="si">%s</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="c1"># Enables the power cap.</span>
<div class="viewcode-block" id="HostManagement.power_cap_enable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_cap_enable">[docs]</a>    <span class="k">def</span> <span class="nf">power_cap_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_power_cap</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span></div>

    <span class="c1"># Disables the power cap.</span>
<div class="viewcode-block" id="HostManagement.power_cap_disable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.power_cap_disable">[docs]</a>    <span class="k">def</span> <span class="nf">power_cap_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_power_cap</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    /xyz/openbmc_project/control/host0/power_cap</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.get_power_cap_settings"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.get_power_cap_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_power_cap_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/power_cap&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">PowerCapEnable</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;PowerCapEnable&#39;</span><span class="p">]</span>
        <span class="n">PowerCap</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;PowerCap&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PowerCapEnable</span><span class="p">,</span> <span class="n">PowerCap</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    curl -b cjar -k -H &#39;Content-Type: application/json&#39; -X POST -d &#39;{&quot;data&quot;:[]}&#39;</span>
<span class="sd">    https://${bmc}/org/open_power/control/gard/action/Reset</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.clear_gard_records"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.clear_gard_records">[docs]</a>    <span class="k">def</span> <span class="nf">clear_gard_records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/org/open_power/control/gard/action/Reset&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &#39;Content-Type: application/json&#39; -X POST</span>
<span class="sd">    -d &#39;{&quot;data&quot;:[]}&#39; https://${bmc}/xyz/openbmc_project/software/action/Reset</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.factory_reset_software"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.factory_reset_software">[docs]</a>    <span class="k">def</span> <span class="nf">factory_reset_software</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/software/action/Reset&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &#39;Content-Type: application/json&#39; -X POST</span>
<span class="sd">    -d &#39;{&quot;data&quot;:[]}&#39; https://${bmc}/xyz/openbmc_project/network/action/Reset</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.factory_reset_network"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.factory_reset_network">[docs]</a>    <span class="k">def</span> <span class="nf">factory_reset_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/network/action/Reset&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : []}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -d &quot;{\&quot;data\&quot;: [\&quot;abc123\&quot;] }&quot;</span>
<span class="sd">    -X POST  https://${bmc}/xyz/openbmc_project/user/root/action/SetPassword</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.update_root_password"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.update_root_password">[docs]</a>    <span class="k">def</span> <span class="nf">update_root_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/user/root/action/SetPassword&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : [&quot;</span><span class="si">%s</span><span class="s1">&quot;]}</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    $ curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X GET</span>
<span class="sd">    https://$BMC_IP/xyz/openbmc_project/control/host0/TPMEnable</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.is_tpm_enabled"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.is_tpm_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">is_tpm_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/TPMEnable&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;TPMEnable&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;# TPMEnable is set&quot;</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="nb">print</span> <span class="s2">&quot;# TPMEnable is cleared&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    curl -c cjar -b cjar -k -H &quot;Content-Type: application/json&quot; -X PUT</span>
<span class="sd">    https://$BMCIP/xyz/openbmc_project/control/host0/TPMEnable/attr/TPMEnable</span>
<span class="sd">    -d &#39;{&quot;data&quot;:1}&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HostManagement.configure_tpm_enable"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.configure_tpm_enable">[docs]</a>    <span class="k">def</span> <span class="nf">configure_tpm_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;/xyz/openbmc_project/control/host0/TPMEnable/attr/TPMEnable&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">{&quot;data&quot; : </span><span class="si">%s</span><span class="s1">}</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">feed_data</span><span class="p">(</span><span class="n">dbus_object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curl</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostManagement.enable_tpm"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.enable_tpm">[docs]</a>    <span class="k">def</span> <span class="nf">enable_tpm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_tpm_enable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostManagement.disable_tpm"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.HostManagement.disable_tpm">[docs]</a>    <span class="k">def</span> <span class="nf">disable_tpm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_tpm_enable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="OpTestOpenBMC"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC">[docs]</a><span class="k">class</span> <span class="nc">OpTestOpenBMC</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ipmi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">rest_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">check_ssh_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">known_hosts_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span> <span class="o">=</span> <span class="n">ipmi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span> <span class="o">=</span> <span class="n">rest_api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="c1"># We kind of hack our way into pxssh by setting original_prompt</span>
        <span class="c1"># to also be \n, which appears to fool it enough to allow us</span>
        <span class="c1"># continue.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">OpTestSSH</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2200</span><span class="p">,</span>
                <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">check_ssh_keys</span><span class="o">=</span><span class="n">check_ssh_keys</span><span class="p">,</span>
                <span class="n">known_hosts_file</span><span class="o">=</span><span class="n">known_hosts_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span> <span class="o">=</span> <span class="n">OpTestBMC</span><span class="p">(</span><span class="n">ip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                            <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                            <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                            <span class="n">check_ssh_keys</span><span class="o">=</span><span class="n">check_ssh_keys</span><span class="p">,</span>
                            <span class="n">known_hosts_file</span><span class="o">=</span><span class="n">known_hosts_file</span><span class="p">)</span>

<div class="viewcode-block" id="OpTestOpenBMC.set_system"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.set_system">[docs]</a>    <span class="k">def</span> <span class="nf">set_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">set_system</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_new_pnor_code_update"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_new_pnor_code_update">[docs]</a>    <span class="k">def</span> <span class="nf">has_new_pnor_code_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">get_list_of_image_ids</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">image_data</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Purpose&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;xyz.openbmc_project.Software.Version.VersionPurpose.Host&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Host image&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="nb">print</span> <span class="s2">&quot;# Checking for pflash os BMC to determine update method&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">validate_pflash_tool</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_vpnor</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.reboot"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.reboot">[docs]</a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
        <span class="c1"># After a BMC reboot, wait for it to reach ready state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span><span class="o">.</span><span class="n">wait_for_bmc_runtime</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.image_transfer"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.image_transfer">[docs]</a>    <span class="k">def</span> <span class="nf">image_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_imageName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">image_transfer</span><span class="p">(</span><span class="n">i_imageName</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.pnor_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.pnor_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">pnor_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnor_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">pnor_img_flash_openbmc</span><span class="p">(</span><span class="n">pnor_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.skiboot_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.skiboot_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">skiboot_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">skiboot_img_flash_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t ask. There appears to be a bug where we need to be 4k aligned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/dev/zero of=/dev/stdout bs=1M count=1 | tr &#39;</span><span class="se">\\</span><span class="s2">000&#39; &#39;</span><span class="se">\\</span><span class="s2">377&#39; &gt; /tmp/ones&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;cat /tmp/</span><span class="si">%s</span><span class="s2"> /tmp/ones &gt; /tmp/padded&quot;</span> <span class="o">%</span> <span class="n">lid_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/tmp/padded of=/usr/local/share/pnor/PAYLOAD bs=1M count=1&quot;</span><span class="p">)</span></div>
            <span class="c1">#self.bmc.run_command(&quot;mv /tmp/%s /usr/local/share/pnor/PAYLOAD&quot; % lid_name, timeout=60)</span>

<div class="viewcode-block" id="OpTestOpenBMC.skiroot_img_flash_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.skiroot_img_flash_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">skiroot_img_flash_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">skiroot_img_flash_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t ask. There appears to be a bug where we need to be 4k aligned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/dev/zero of=/dev/stdout bs=16M count=1 | tr &#39;</span><span class="se">\\</span><span class="s2">000&#39; &#39;</span><span class="se">\\</span><span class="s2">377&#39; &gt; /tmp/ones&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;cat /tmp/</span><span class="si">%s</span><span class="s2"> /tmp/ones &gt; /tmp/padded&quot;</span> <span class="o">%</span> <span class="n">lid_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;dd if=/tmp/padded of=/usr/local/share/pnor/BOOTKERNEL bs=16M count=1&quot;</span><span class="p">)</span></div>
            <span class="c1">#self.bmc.run_command(&quot;mv /tmp/%s /usr/local/share/pnor/BOOTKERNEL&quot; % lid_name, timeout=60)</span>

<div class="viewcode-block" id="OpTestOpenBMC.flash_part_openbmc"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.flash_part_openbmc">[docs]</a>    <span class="k">def</span> <span class="nf">flash_part_openbmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_new_pnor_code_update</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">flash_part_openbmc</span><span class="p">(</span><span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;mv /tmp/</span><span class="si">%s</span><span class="s2"> /usr/local/share/pnor/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lid_name</span><span class="p">,</span> <span class="n">part_name</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.clear_field_mode"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.clear_field_mode">[docs]</a>    <span class="k">def</span> <span class="nf">clear_field_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;fw_setenv fieldmode&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s2">&quot;systemctl unmask usr-local.mount&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.bmc_host"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.bmc_host">[docs]</a>    <span class="k">def</span> <span class="nf">bmc_host</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_ipmi"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_ipmi">[docs]</a>    <span class="k">def</span> <span class="nf">get_ipmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipmi</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_host_console"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_host_console">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.get_rest_api"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.get_rest_api">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_api</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_api</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.run_command"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.run_command">[docs]</a>    <span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmc</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_inband_bootdev"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_inband_bootdev">[docs]</a>    <span class="k">def</span> <span class="nf">has_inband_bootdev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_os_boot_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_os_boot_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_os_boot_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_host_status_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_host_status_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_host_status_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="OpTestOpenBMC.has_occ_active_sensor"><a class="viewcode-back" href="../../programming.html#common.OpTestOpenBMC.OpTestOpenBMC.has_occ_active_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">has_occ_active_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">op-test-framework</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=open-power&repo=op-test-framework&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a href="https://travis-ci.org/open-power/op-test-framework">
    <img
        alt="https://secure.travis-ci.org/open-power/op-test-framework.svg?branch=master"
        src="https://secure.travis-ci.org/open-power/op-test-framework.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide.html">op-test User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Programming Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#generic-classes-modules">Generic Classes/Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#bmc-machine-specific">BMC/Machine Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programming.html#module-testcases.OpTestFlash">Firmware Flashing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, OpenPOWER Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    
    <a href="https://github.com/open-power/op-test-framework" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>